{% extends '_layouts/in_app.html.twig' %}

{% block title %}Accueil - X Clone{% endblock %}

{% block content %}
    <div class="feed-header">
        <h2>Pour vous</h2>
        <h2>Abonnements</h2>
    </div>

    <div class="create-post">
         <img src="{{ asset('pdp.jpg') }}" alt="Mon profil" class="avatar">
        <div class="input-area">
            <input type="text" placeholder="Quoi de neuf ?">
            <div class="actions">
                <div class="icons">
                    <i class="fa-regular fa-image"></i>
                    <i class="fa-solid fa-list-ul"></i>
                    <i class="fa-regular fa-face-smile"></i>
                </div>
                <button class="post-btn-small">Poster</button>
            </div>
        </div>
    </div>

    {% for tweet in tweets %}
        <div class="post" onclick="window.location.href='{{ path('app_tweet_show', {'id': tweet.id}) }}'">
            <a href="{{ path('app_profile_show', {'id': tweet.createdBy.id}) }}" onclick="event.stopPropagation();">
                <img src="https://i.pravatar.cc/100?u={{ tweet.createdBy.id|default('default') }}" alt="Avatar" class="avatar">
            </a>
            <div class="post-content">
                <div class="post-header">
                    <a href="{{ path('app_profile_show', {'id': tweet.createdBy.id}) }}" class="profile-link" onclick="event.stopPropagation();">
                        <span class="name">{{ tweet.createdBy.username|default('Anonyme') }}</span>
                    </a>
                    <span class="handle">@{{ tweet.createdBy.username|default('anonyme')|lower }} • {{ tweet.ago }}</span>
                </div>
                <p class="text">{{ tweet.content }}</p>
                <div class="post-footer">
                    <a href="{{ path('app_tweet_show', {'id': tweet.id}) }}" class="comment-link" onclick="event.stopPropagation();">
                        <span>
                            <i class="fa-regular fa-comment"></i> 
                            {{ commentService is defined ? commentService.findCommentsByTweetId(tweet.id)|length : 0 }}
                        </span>
                    </a>
                    <span onclick="event.stopPropagation();"><i class="fa-solid fa-retweet"></i> 0</span>
                    <a href="{{ path('tweet_like', {'id': tweet.id}) }}" class="like-link" onclick="event.stopPropagation();">
                        <span>
                            <i class="fa-{{ likeService.countLikesByTweetId(tweet.id) > 0 ? 'solid' : 'regular' }} fa-heart"></i> 
                            <span class="like-count">{{ likeService.countLikesByTweetId(tweet.id) }}</span>
                        </span>
                    </a>
                    <span onclick="event.stopPropagation();"><i class="fa-solid fa-chart-simple"></i> 0</span>
                </div>
            </div>
        </div>
    {% else %}
        <div class="post">
            <p class="text">Aucun tweet ? Suivez des gens pour commencer !</p>
        </div>
    {% endfor %}

    <div class="pagination" style="display: flex; justify-content: center; gap: 20px; margin: 20px 0; padding: 10px;">
        {% if currentPage > 1 %}
            <a href="?page={{ currentPage - 1 }}" class="post-btn-small" style="text-decoration: none;">Précédent</a>
        {% endif %}
        
        {# On affiche le bouton suivant s'il y a des tweets sur la page actuelle (potentiellement une page suivante) #}
        {% if tweets|length >= 10 %}
            <a href="?page={{ currentPage + 1 }}" class="post-btn-small" style="text-decoration: none;">Suivant</a>
        {% endif %}
    </div>
{% endblock %}
